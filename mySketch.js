const noiseScale=150;let particles=[];const sqSize=20,sqSpacing=50,numParticles=1e3,circleRadius=750;var angleOfRotation=-.5,nz=0;let seed;function setup(){createCanvas(1112,834),colorMode(HSB,255),background(0),seed=floor(random(9999999)),randomSeed(seed),smooth();for(var e=0;e<20;e++)for(var s=0;s<20;s++){var o=new Particle(width/2+50*(s-10),height/2+50*(e-10)*4);particles.push(o)}fill(0),ellipseMode(CENTER)}function draw(){for(var e=0;e<particles.length;e++)particles[e].update(),particles[e].display()}function keyPressed(e){"S"==key&&saveCanvas("sketch_"+seed,"jpg")}class Particle{constructor(e,s){this.pos=createVector(e,s),this.nextPos=createVector(e,s),this.dead=!1,this.deadVel=createVector(0,random(0,6))}update(){var e;e=random()>.1?curlNoise(this.pos.x,this.pos.y):vecFromNoise(this.pos.x,this.pos.y),random()>.999&&(this.dead=!0),this.dead&&(e=this.deadVel),e.normalize(),e.x*=2,this.nextPos.add(e)}display(){stroke(0,150*noise(this.pos.x,this.pos.y)),dist(this.pos.x,this.pos.y,width/2,height/2)>750&&stroke(frameCount%255,55,155,90),noFill(),stroke(frameCount%255,55,155,map(sin(this.pos.y/800),-1,1,30,1)),strokeWeight(60),line(this.pos.x,perspectiveTransformY([this.pos.x,this.pos.y]),this.nextPos.x,perspectiveTransformY([this.nextPos.x,this.nextPos.y])),this.pos.x=this.nextPos.x,this.pos.y=this.nextPos.y}}function perspectiveTransformY(e){return(e[1]-height/2)*sin(angleOfRotation)+height/2+500*noise(e[0]/300,e[1]/300,nz)}function perspectiveTransformX(e){return(e[0]-width/2)*cos(angleOfRotation)+width/2+500*noise(e[0]/300,e[1]/300,nz)}function sqVecFromNoise(e,s){var o=Math.floor(map(noise(e/150,s/150,nz),0,1,0,8));return o=o*(TWO_PI/8)*2-TWO_PI,p5.Vector.fromAngle(o)}function vecFromNoise(e,s){var o=map(noise(e/150,s/150,nz),0,1,-TWO_PI,TWO_PI);return p5.Vector.fromAngle(o)}function curlNoise(e,s){const o=1/150;let t,n,i,r;e/=150,s/=150,t=noise(e,s+o,nz),n=noise(e,s-o,nz),i=(t-n)/(2*o),t=noise(e+o,s,nz),n=noise(e-o,s,nz),r=(t-n)/(2*o);var a=createVector(i,-r);return a.normalize(),a}function curlNoiseFloored(e,s){const o=2/150;let t,n,i,r;noiseDetail(2,.5),e/=150,s/=150,t=noise(e,s+o,nz),n=noise(e,s-o,nz),i=(t-n)/(2*o),t=noise(e+o,s,nz),n=noise(e-o,s,nz),r=(t-n)/(2*o);var a=createVector(i,-r),c=a.heading(),h=TWO_PI*(floor(c/TWO_PI*2)/float(2));return p5.Vector.fromAngle(h)}function mousePressed(){save("screen.jpg")}Particle.MAX_PATH_LENGTH=50;